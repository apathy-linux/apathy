From 6d92befa1eecec7170856512e1c002a081bf906e Mon Sep 17 00:00:00 2001
From: must_eat <mss@tutanota.de>
Date: Thu, 28 Apr 2022 13:15:22 +0300
Subject: [PATCH 4/8] libcxxabi: force link against compiler-rt.

---
 libcxxabi/src/CMakeLists.txt | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/libcxxabi/src/CMakeLists.txt b/libcxxabi/src/CMakeLists.txt
index 762649a96..5093d0cdf 100644
--- a/libcxxabi/src/CMakeLists.txt
+++ b/libcxxabi/src/CMakeLists.txt
@@ -178,6 +178,11 @@ endif()
 if (LIBCXXABI_ENABLE_SHARED)
   add_library(cxxabi_shared SHARED ${LIBCXXABI_SOURCES} ${LIBCXXABI_HEADERS})
   target_link_libraries(cxxabi_shared PRIVATE cxx-headers ${LIBCXXABI_SHARED_LIBRARIES} ${LIBCXXABI_LIBRARIES})
+
+  if (LIBCXXABI_USE_COMPILER_RT)
+    target_link_libraries(cxxabi_shared PRIVATE ${LIBCXXABI_BUILTINS_LIBRARY})
+  endif()
+
   if (TARGET pstl::ParallelSTL)
     target_link_libraries(cxxabi_shared PUBLIC pstl::ParallelSTL)
   endif()
@@ -233,6 +238,11 @@ endif()
 if (LIBCXXABI_ENABLE_STATIC)
   add_library(cxxabi_static STATIC ${LIBCXXABI_SOURCES} ${LIBCXXABI_HEADERS})
   target_link_libraries(cxxabi_static PRIVATE cxx-headers ${LIBCXXABI_STATIC_LIBRARIES} ${LIBCXXABI_LIBRARIES})
+
+  if (LIBCXXABI_USE_COMPILER_RT)
+    target_link_libraries(cxxabi_static PRIVATE ${LIBCXXABI_BUILTINS_LIBRARY})
+  endif()
+
   if (TARGET pstl::ParallelSTL)
     target_link_libraries(cxxabi_static PUBLIC pstl::ParallelSTL)
   endif()
-- 
2.36.0

