#!/mss/bin/sh
. /mss/files/funcs
rootcheck

if   [ ! -f ./arch/x86/boot/bzImage ]; then
 aprint_nc
 aprint_fail "bzImage doesn't exist."
 aprint_nc
 exit 1
elif [ ! -f ./System.map ]; then
 aprint_nc
 aprint_fail "System.map doesn't exist."
 aprint_nc
 exit 1
elif [ ! -f ./.config ]; then
 aprint_nc
 aprint_fail ".config doesn't exist."
 aprint_nc
 exit 1
fi

aprint_nc
aprint_ask "replace the kernel? (y/Y/yes|n/N/no): "
read answer

case "${answer}" in
 y|Y|yes)
  aprint_nc
  aprint_ret "copying ${cl_grn}bzImage${c_res} to ${cl_grn}/boot/vmlinuz${c_res}."
   cp arch/x86/boot/bzImage /boot/vmlinuz
  evalretkill

  aprint_ret "copying ${cl_grn}System.map${c_res} to ${cl_grn}/boot/System.map${c_res}."
   cp System.map /boot/System.map
  evalretkill

  aprint_ret "copying kernel ${cl_grn}config${c_res} to ${cl_grn}/boot/config${c_res}."
   cp .config /boot/config
  evalretkill

  aprint_ret "running ${cl_grn}lilo${c_res}."
   lilo >/dev/null 2>&1
  evalretkill
  aprint_nc
 ;;
 n|N|no)
  aprint_nc
  aprint "aborting."
  aprint_nc
  exit 1
 ;;
 *)
  aprint_nc
  aprint_usage "{y|Y|yes}{n|N|no}"
  aprint_nc
  exit 1
esac
